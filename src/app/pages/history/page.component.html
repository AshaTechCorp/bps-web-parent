<app-navbar></app-navbar>
<!-- User : Parent -->
<div *ngIf="role === 'parent'" class="flex justify-center items-start font-ibm font-medium w-full bg-[#F4F4F9]">
  <!-- Admin card HTML content here -->
  <div class="flex justify-center items-start font-ibm font-medium w-full">
    <div class="flex flex-col justify-center md:flex-row w-full mt-[30px]">
      <div class="flex flex-col items-center md:items-start rounded-xl md:mr-[40px]">
        <!-- Your SVG content -->
        <ng-container *ngIf="card.role == 'business'; else elseTemplate">
					<div class="w-[351px] h-[200px] px-[20px] py-[16px] rounded-[12px]" [style.background-image]="'url(' + bg_card() + ')'">
						<div class="flex flex-col justify-between w-full h-full">
							<p class="text-[16px] font-medium leading-[32px] text-[#FFFFFF]">{{card.name}}</p>
							<div class="flex divide-x divide-white">
								<div class="w-[239px]">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Available Balance (Baht)</p>
									<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.balance | number: '1.2-2'}}</p>
								</div>
								<div class="w-14 pl-4">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Coupons</p>
									<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.coupon}}</p>
								</div>
							</div>
							<div class="flex justify-between h-[22px] items-center">
								<div class="flex">
									<img (click)="clickForUpdateTime()" class="w-[18px] hover:cursor-pointer" src="../../../../assets/images/logo/card/refresh_icon.svg" alt="">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Updated at {{card.update}}</p>
								</div>
								<div>
									<img class="w-[100px]" [src]="text_card()" alt="">
								</div>
							</div>
						</div>
					</div>
				</ng-container>
				<ng-template #elseTemplate>
					<div class="w-[351px] h-[200px] px-[20px] py-[16px] rounded-[12px]" [style.background-image]="'url(' + bg_card() + ')'">
						<div class="flex flex-col justify-between w-full h-full">
							<p class="text-[16px] font-medium leading-[32px] text-[#FFFFFF]">{{card.name}}</p>
							<div>
								<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Available Balance (Baht)</p>
								<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.balance | number: '1.2-2'}}</p>
							</div>
							<div class="flex justify-between h-[22px] items-center">
								<div class="flex">
									<img (click)="clickForUpdateTime()" class="w-[18px] hover:cursor-pointer" src="../../../../assets/images/logo/card/refresh_icon.svg" alt="">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Updated at {{card.update}}</p>
								</div>
								<div>
									<img class="w-[100px]" [src]="text_card()" alt="">
								</div>
							</div>
						</div>
					</div>
				</ng-template>
        <div class=" hidden md:block" (click)="backto()" >
          <button class="flex items-center py-[18px] text-[#990033]">
          <mat-icon class="text-[#990033]" svgIcon="heroicons_mini:chevron-left"></mat-icon>
          <p class="flex items-center text-lg mt-[2px]">BACK</p>
          </button>
        </div>
      </div>
      <div class="rounded-xl bg-white md:w-[595px] md:min-w-0 md:mt-0 mt-8" >
        <div class="flex justify-between items-center px-4 mt-4">
          <p class="font-medium text-[#002755] text-[20px] min-[404px]:text-[24px]">Transactions History</p>
          <div class="">
            <select class="block w-auto bg-white px-2 py-2" [(ngModel)]="selectedDate">
              <option *ngFor="let monthYear of monthsYears" [value]="monthYear">{{ monthYear }}</option>
            </select>
          </div>
        </div>
        <p class="text-md font-normal text-[#32373D] px-4">Let’s see how your spending looks, spending data is available past 12 months</p>
        <div class="flex justify-around items-center md:min-w-[375px] p-4">
          <div class="flex flex-col w-[260px] md:min-w-0 h-[72px] bg-[#DEE6F9] rounded-xl p-3 mr-4">
            <p class="text-sm font-normal text-[#84776E]">Total Top-up</p>
            <p class="text-2xl">฿ {{total[0].balance | number:'1.2-2'}}</p>
          </div>
          <div class="flex flex-col w-[260px] md:min-w-0 h-[72px] bg-[#FCE4E1] rounded-xl p-3">
            <p class="text-sm font-normal text-[#84776E]">Total spending</p>
            <p class="text-2xl">฿ {{total[1].balance | number:'1.2-2'}}</p>
          </div>
        </div>
        <div class="overflow-y-scroll max-h-[calc(100vh-536px)] min-[482px]:max-h-[calc(100vh-516px)] md:max-h-[calc(100vh-350px)]">
          <ng-container *ngIf="history.length === 0">
            <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
              <p>March 2024</p>
            </div>
            <div class="flex justify-center md:py-16 py-28">
              <div class="flex flex-col items-center">
                <img class="w-8" src="assets/images/transactions/not_found.svg">
                <p class="font-normal text-[#32373D]">Transaction not found</p>
              </div>
            </div>
          </ng-container>
          <ng-container *ngFor="let item of getReversedHistory(); let i=index" style="overflow-y: scroll; max-height: 800px;">
            <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
              <p>{{item.date}}</p>
            </div>
            <ng-container *ngFor="let transaction of item.data; let j=index">
              <div class="px-4">
                <ng-container *ngIf="j != 0">
                  <div class="border-b border-[#DED7D1] w-full"></div>
                </ng-container>
              </div>
              <div class="flex justify-between">
                <div class="p-4">
                  <div class="flex items-center">
                    <div class="w-[14px] h-[14px] rounded-full mb-[2px]" [ngStyle]="{'background': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}"></div>
                    <p class="px-2 text-lg">{{transaction.type}}</p>
                  </div>
                  <p class="text-md font-normal text-[#84776E]">{{transaction.time}}</p>
                </div>
                <div class="flex flex-col items-end p-4">
                  <p [ngStyle]="{'color': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}">{{transaction.balance | number:'1.2-2'}}</p>
                  <mat-icon class="text-[#32373D] hover:cursor-pointer" (click)="openDialogOrBottomSheet(i, j)" svgIcon="heroicons_mini:chevron-right"></mat-icon>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User : Staff -->

<div *ngIf="role === 'staff'" class="flex justify-center items-start font-ibm font-medium w-full bg-[#F4F4F9]">
  <!-- User card HTML content here -->
  <div class="flex justify-center items-start font-ibm font-medium w-full">
    <div class="flex flex-col justify-center md:flex-row w-full mt-[30px]">
      <div class="flex flex-col items-center md:items-start rounded-xl md:mr-[40px]">
        <!-- Your SVG content -->
        <ng-container *ngIf="card.role == 'business'; else elseTemplate">
					<div class="w-[351px] h-[200px] px-[20px] py-[16px] rounded-[12px]" [style.background-image]="'url(' + bg_card() + ')'">
						<div class="flex flex-col justify-between w-full h-full">
							<p class="text-[16px] font-medium leading-[32px] text-[#FFFFFF]">{{card.name}}</p>
							<div class="flex divide-x divide-white">
								<div class="w-[239px]">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Available Balance (Baht)</p>
									<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.balance | number: '1.2-2'}}</p>
								</div>
								<div class="w-14 pl-4">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Coupons</p>
									<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.coupon}}</p>
								</div>
							</div>
							<div class="flex justify-between h-[22px] items-center">
								<div class="flex">
									<img (click)="clickForUpdateTime()" class="w-[18px] hover:cursor-pointer" src="../../../../assets/images/logo/card/refresh_icon.svg" alt="">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Updated at {{card.update}}</p>
								</div>
								<div>
									<img class="w-[100px]" [src]="text_card()" alt="">
								</div>
							</div>
						</div>
					</div>
				</ng-container>
				<ng-template #elseTemplate>
					<div class="w-[351px] h-[200px] px-[20px] py-[16px] rounded-[12px]" [style.background-image]="'url(' + bg_card() + ')'">
						<div class="flex flex-col justify-between w-full h-full">
							<p class="text-[16px] font-medium leading-[32px] text-[#FFFFFF]">{{card.name}}</p>
							<div>
								<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Available Balance (Baht)</p>
								<p class="text-[34px] font-medium text-[#FFFFFF]">{{card.balance | number: '1.2-2'}}</p>
							</div>
							<div class="flex justify-between h-[22px] items-center">
								<div class="flex">
									<img (click)="clickForUpdateTime()" class="w-[18px] hover:cursor-pointer" src="../../../../assets/images/logo/card/refresh_icon.svg" alt="">
									<p class="text-[14px] font-normal tracking-[0.1px] text-[#FFFFFF]">Updated at {{card.update}}</p>
								</div>
								<div>
									<img class="w-[100px]" [src]="text_card()" alt="">
								</div>
							</div>
						</div>
					</div>
				</ng-template>
        <div class=" hidden md:block" (click)="backto()" >
          <button class="flex items-center py-[18px] text-[#990033]">
          <mat-icon class="text-[#990033]" svgIcon="heroicons_mini:chevron-left"></mat-icon>
          <p class="flex items-center text-lg mt-[2px]">BACK</p>
          </button>
        </div>
      </div>
      <div class="rounded-xl bg-white w-full h-[100%] md:w-[595px] md:min-w-0 md:mt-0 mt-8 max-h-screen" >
        <div class="grid grid-cols-2 md:flex border-b-2 w-full h-[52px] mb-[10px]">
          <div class="flex flex-col h-[52px] col-span-1 md:w-[180px] justify-center items-center border-b-2" [ngClass]="{'border-[#990033]': !showTransactions}" (click)="toggleTransactions()">
            <p class="font-normal hover:cursor-pointer" [ngClass]="{'font-semibold': !showTransactions, 'text-[#990033]': !showTransactions}">Transaction</p>
          </div>
          <div class="flex flex-col h-[52px] col-span-1 md:w-[180px] justify-center items-center border-b-2" [ngClass]="{'border-[#990033]': showTransactions}" (click)="toggleTransactions()">
            <p class="font-normal hover:cursor-pointer" [ngClass]="{'font-semibold': showTransactions, 'text-[#990033]': showTransactions}">Coupon</p>
          </div>
        </div>
        <div *ngIf="showTransactions">
          <div class="flex justify-between items-center px-4">
            <p class="font-medium text-[#002755] text-[24px]">Coupon History</p>
            <div class="">
              <select class="block w-auto bg-white px-2 py-2" [(ngModel)]="selectedDate">
                <option *ngFor="let monthYear of monthsYears" [value]="monthYear">{{ monthYear }}</option>
              </select>
            </div>
          </div>
          <p class="text-md font-normal text-[#32373D] px-4 pb-4">Let’s see how your spending looks, spending data is available past 12 months</p>
          <div class="overflow-y-scroll max-h-[calc(100vh-494px)] min-[482px]:max-h-[calc(100vh-474px)] md:max-h-[calc(100vh-308px)]">
            <ng-container *ngIf="history.length === 0">
              <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
                <p>March 2024</p>
              </div>
              <div class="flex justify-center md:py-16 py-28">
                <div class="flex flex-col items-center">
                  <img class="w-8" src="assets/images/transactions/not_found.svg">
                  <p class="font-normal text-[#32373D]">Coupon not found</p>
                </div>
              </div>
            </ng-container>
            <ng-container *ngFor="let item of getReversedHistory(); let i=index">
              <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
                <p>{{item.date}}</p>
              </div>
              <ng-container *ngFor="let transaction of item.data; let j=index">
                <div class="px-4">
                  <ng-container *ngIf="j != 0">
                    <div class="border-b border-[#DED7D1] w-full"></div>
                  </ng-container>
                </div>
                <div class="flex justify-between">
                  <div class="p-4">
                    <div class="flex items-center">
                      <div class="w-[14px] h-[14px] rounded-full mb-[2px]" [ngStyle]="{'background': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}"></div>
                      <p class="px-2 text-lg">{{transaction.type}}</p>
                    </div>
                    <p class="text-md font-normal text-[#84776E]">{{transaction.time}}</p>
                  </div>
                  <div class="flex flex-col items-end p-4">
                    <p [ngStyle]="{'color': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}">{{transaction.balance | number:'1.2-2'}}</p>
                    <mat-icon class="text-[#32373D] hover:cursor-pointer" (click)="openDialogOrBottomSheet(i, j)" svgIcon="heroicons_mini:chevron-right"></mat-icon>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </div>
        </div>

        <div *ngIf="!showTransactions">
          <div class="flex justify-between items-center px-4">
            <p class="font-medium text-[#002755] text-[20px] min-[404px]:text-[24px]">Transactions History</p>
            <div class="">
              <select class="block w-auto bg-white px-2 py-2" [(ngModel)]="selectedDate">
                <option *ngFor="let monthYear of monthsYears" [value]="monthYear">{{ monthYear }}</option>
              </select>
            </div>
          </div>
          <p class="text-md font-normal text-[#32373D] px-4">Let’s see how your spending looks, spending data is available past 12 months</p>
          <div class="flex justify-around items-center md:min-w-[375px] p-4 mb-1">
            <div class="flex flex-col w-[260px] md:min-w-0 h-[72px] bg-[#DEE6F9] rounded-xl p-3 mr-4">
              <p class="text-sm font-normal text-[#84776E]">Total Top-up</p>
              <p class="text-2xl">฿ {{total[0].balance | number:'1.2-2'}}</p>
            </div>
            <div class="flex flex-col w-[260px] md:min-w-0 h-[72px] bg-[#FCE4E1] rounded-xl p-3">
              <p class="text-sm font-normal text-[#84776E]">Total spending</p>
              <p class="text-2xl">฿ {{total[1].balance | number:'1.2-2'}}</p>
            </div>
          </div>
          <div class="overflow-y-scroll max-h-[calc(100vh-586px)] min-[482px]:max-h-[calc(100vh-566px)] md:max-h-[calc(100vh-400px)]">
            <ng-container *ngIf="history.length === 0">
              <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
                <p>March 2024</p>
              </div>
              <div class="flex justify-center md:py-16 py-28">
                <div class="flex flex-col items-center">
                  <img class="w-8" src="assets/images/transactions/not_found.svg">
                  <p class="font-normal text-[#32373D]">Transaction not found</p>
                </div>
              </div>
            </ng-container>
            <ng-container *ngFor="let item of getReversedHistory(); let i=index" style="overflow-y: scroll;">
              <div class="flex items-center h-[32px] w-full bg-[#DED7D1] p-4 text-[#84776E]">
                <p>{{item.date}}</p>
              </div>
              <ng-container *ngFor="let transaction of item.data; let j=index">
                <div class="px-4">
                  <ng-container *ngIf="j != 0">
                    <div class="border-b border-[#DED7D1] w-full"></div>
                  </ng-container>
                </div>
                <div class="flex justify-between">
                  <div class="p-4">
                    <div class="flex items-center">
                      <div class="w-[14px] h-[14px] rounded-full mb-[2px]" [ngStyle]="{'background': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}"></div>
                      <p class="px-2 text-lg">{{transaction.type}}</p>
                    </div>
                    <p class="text-md font-normal text-[#84776E]">{{transaction.time}}</p>
                  </div>
                  <div class="flex flex-col items-end p-4">
                    <p [ngStyle]="{'color': transaction.type === 'Paid' ? '#FF5252' : '#4CAF50'}">{{transaction.balance | number:'1.2-2'}}</p>
                    <mat-icon class="text-[#32373D] hover:cursor-pointer" (click)="openDialogOrBottomSheet(i, j)" svgIcon="heroicons_mini:chevron-right"></mat-icon>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
